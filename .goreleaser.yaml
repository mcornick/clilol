---
announce:
  mastodon:
    enabled: true
    server: https://social.sdf.org
  skip: '{{ne .Prerelease ""}}'
  smtp:
    enabled: true
    host: smtp.fastmail.com
    port: 587
    from: mark@markcornick.com
    to:
      - ~mcornick/clilol@lists.sr.ht
    username: mcornick@mcornick.com
archives:
  - builds_info:
      group: root
      owner: root
    files:
      - README.md
      - LICENSE
      - completions/*
      - manpages/*.1
    format_overrides:
      - format: zip
        goos: windows
aurs:
  - description: A CLI for omg.lol
    git_url: ssh://git@git.mcornick.dev:222/mcornick/clilol-aur.git
    homepage: https://clilol.mcornick.dev/
    license: MPL-2.0
    maintainers:
      - Mark Cornick <mcornick@mcornick.com>
    name: clilol-bin
    package: |-
      install -Dm755 "./clilol" "${pkgdir}/usr/bin/clilol"
      install -Dm644 "./LICENSE" "${pkgdir}/usr/share/licenses/clilol/LICENSE"
      mkdir -p "${pkgdir}/usr/share/bash-completion/completions/"
      mkdir -p "${pkgdir}/usr/share/zsh/site-functions/"
      mkdir -p "${pkgdir}/usr/share/fish/vendor_completions.d/"
      install -Dm644 "./completions/clilol.bash" "${pkgdir}/usr/share/bash-completion/completions/clilol"
      install -Dm644 "./completions/clilol.zsh" "${pkgdir}/usr/share/zsh/site-functions/_clilol"
      install -Dm644 "./completions/clilol.fish" "${pkgdir}/usr/share/fish/vendor_completions.d/clilol.fish"
      install -Dm644 "./manpages/*.1" "${pkgdir}/usr/share/man/man1/*.1"
    private_key: "~/.ssh/0a0692e0-075e-4616-9aeb-6d51472edd94"
before:
  hooks:
    - go mod tidy
    - bash ./scripts/completions.sh
    - bash ./scripts/manpages.sh
brews:
  - description: A CLI for omg.lol
    homepage: https://clilol.mcornick.dev/
    install: |-
      bin.install "clilol"
      bash_completion.install "completions/clilol.bash" => "clilol"
      zsh_completion.install "completions/clilol.zsh" => "_clilol"
      fish_completion.install "completions/clilol.fish"
      man1.install Dir["manpages/*.1"]
    license: MPL-2.0
    repository:
      name: homebrew-tap
      git: 
        url: "ssh://git@git.mcornick.dev:222/mcornick/homebrew-tap.git"
        private_key: "~/.ssh/0a0692e0-075e-4616-9aeb-6d51472edd94"
builds:
  - env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
    ldflags:
      - -s -w -X git.mcornick.dev/mcornick/clilol/cmd.version={{.Version}} -X git.mcornick.dev/mcornick/clilol/cmd.commit={{.ShortCommit}} -X git.mcornick.dev/mcornick/clilol/cmd.date={{.CommitDate}}
    mod_timestamp: "{{ .CommitTimestamp }}"
    targets:
      - go_first_class
changelog:
  filters:
    exclude:
      - "^test:"
      - "^chore:"
      - "^docs:"
      - merge conflict
      - Merge pull request
      - Merge remote-tracking branch
      - Merge branch
      - go mod tidy
  sort: asc
checksum:
  name_template: checksums.txt
docker_signs:
  - args:
      - sign
      - --yes
      - --key=$HOME/cosign.key
      - ${artifact}@${digest}
    artifacts: manifests
gitea_urls:
  api: https://git.mcornick.dev/api/v1
  download: https://git.mcornick.dev
  skip_tls_verify: false
kos:
  - bare: true
    build: clilol
    creation_time: "{{.CommitTimestamp}}"
    ko_data_creation_time: "{{.CommitTimestamp}}"
    labels:
      io.artifacthub.package.license: MPL-2.0
      io.artifacthub.package.maintainers: '[{"name":"Mark Cornick","email":"mcornick@mcornick.com"}]'
      io.artifacthub.package.readme-url: https://git.mcornick.dev/mcornick/clilol/raw/branch/main/README.md
      org.opencontainers.image.description: A CLI for omg.lol
      org.opencontainers.image.name: "{{.ProjectName}}"
      org.opencontainers.image.revision: "{{.FullCommit}}"
      org.opencontainers.image.source: "{{.GitURL}}"
      org.opencontainers.image.version: "{{.Version}}"
    platforms:
      - linux/amd64
      - linux/arm64
    repository: git.mcornick.dev/mcornick/clilol
    tags:
      - latest
      - "{{.Tag}}"
milestones:
  - close: true
nfpms:
  - archlinux:
      packager: Mark Cornick <mcornick@mcornick.com>
    contents:
      - dst: /usr/share/bash-completion/completions/clilol
        file_info:
          mode: 0644
        src: ./completions/clilol.bash
      - dst: /usr/share/fish/vendor_completions.d/clilol.fish
        file_info:
          mode: 0644
        src: ./completions/clilol.fish
      - dst: /usr/share/zsh/vendor-completions/_clilol
        file_info:
          mode: 0644
        src: ./completions/clilol.zsh
      - dst: /usr/share/man/man1/
        file_info:
          mode: 0644
        src: ./manpages/*.1
      - dst: /usr/share/doc/clilol/copyright
        file_info:
          mode: 0644
        src: ./LICENSE
    description: A CLI for omg.lol
    formats:
      - apk
      - archlinux
      - deb
      - rpm
    homepage: https://clilol.mcornick.dev/
    license: MPL-2.0
    maintainer: Mark Cornick <mcornick@mcornick.com>
    vendor: Mark Cornick
release:
  gitea:
    owner: mcornick
    name: clilol
sboms:
  - artifacts: archive
scoops:
  - repository:
      git: 
        url: "ssh://git@git.mcornick.dev:222/mcornick/scoop-bucket.git"
        private_key: "~/.ssh/0a0692e0-075e-4616-9aeb-6d51472edd94"
    description: A CLI for omg.lol
    homepage: https://clilol.mcornick.dev/
    license: MPL-2.0
signs:
  - artifacts: checksum
snapshot:
  name_template: "{{ incpatch .Version }}-next"
universal_binaries:
  - replace: true
